<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PCPick � Products</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="assets/icon.ico">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- HEADER -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="index.html">
        <img src="assets/logo.png" alt="PCPick logo" class="logo-icon" width="36" height="36"/>
        <span class="logo-wordmark">
          <span class="logo-pc">PC</span><span class="logo-pick">PICK</span>
        </span>
      </a>

      <nav class="nav">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="products.html" class="active">Products</a></li>
          <li><a href="pcbuilder.html">PC Builder</a></li>
          <li><a href="prebuiltpc.html">Pre-built PCs</a></li>
        </ul>
      </nav>

      <div class="nav-actions">
        <a class="login" data-auth-visible="signed-out" href="login.html">Log In</a>
        <a class="btn signup" data-auth-visible="signed-out" href="signup.html">Sign Up</a>

        <!-- Custom Icon Toggle -->
        <label class="theme-toggle">
          <input type="checkbox" id="theme-switch" />
          <span class="slider">
            <span class="sun"></span>
            <span class="moon"></span>
          </span>
        </label>
        <button class="menu-toggle" aria-label="Open menu" id="menu-toggle">&#9776;</button>
      </div>
    </div>
    <nav class="drawer-nav" id="mobile-drawer" aria-label="Mobile navigation" aria-hidden="true">
    <div class="drawer-header">
      <span class="drawer-brand">
        <img src="assets/logo.png" alt="PCPick logo" class="logo-icon" width="36" height="36" />
        <span class="logo-wordmark"><span class="logo-pc">PC</span><span class="logo-pick">PICK</span></span>
      </span>
      <button class="drawer-close" id="drawer-close" aria-label="Close menu">&times;</button>
    </div>
    <ul class="drawer-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="products.html">Products</a></li>
      <li><a href="pcbuilder.html">PC Builder</a></li>
      <li><a href="prebuiltpc.html">Pre-built PCs</a></li>
    </ul>
    <div class="drawer-actions">
      <a class="login" data-auth-visible="signed-out" href="login.html">Log In</a>
      <a class="btn signup" data-auth-visible="signed-out" href="signup.html">Sign Up</a>
    </div>
  </nav>
  <div class="drawer-overlay" id="drawer-overlay" hidden></div></header>

  <!-- PRODUCTS SECTION -->
  <main>
    <section class="container products">
      <h1 class="section-title">Products</h1>
      <p class="section-description">Browse and Purchase Individual PC Components.</p>

      <!-- Tabs + search (use the products-controls/product-tabs wrapper so search sits to the right) -->
      <div class="products-controls">
        <div class="product-tabs" role="tablist" aria-label="product categories">
          <button class="tab active" data-cat="cpu-section">CPUs</button>
          <button class="tab" data-cat="gpu-section">Graphics Cards</button>
          <button class="tab" data-cat="memory-section">Memory (RAM)</button>
          <button class="tab" data-cat="motherboard-section">Motherboards</button>
          <button class="tab" data-cat="storage-section">Storage</button>
          <button class="tab" data-cat="psu-section">Power Supplies</button>
          <button class="tab" data-cat="case-section">Cases</button>
          <button class="tab" data-cat="cooling-section">Cooling</button>
        </div>

        <div class="product-search">
          <input type="search" placeholder="Search products..." aria-label="Search products">
        </div>
      </div>

      <!-- CPU PRODUCTS -->
      <div id="cpu-section" class="product-grid is-active">
        <div class="product-card">
          <img src="assets/Ryzen9_7950X.jpg" alt="Ryzen 9 7950X">
          <div class="product-info">
            <h3>AMD Ryzen 9 7950X</h3>
            <ul>
              <li>16 Cores / 32 Threads</li>
              <li>5.7 GHz Boost</li>
              <li>AM5 Socket</li>
            </ul>
            <p class="price">$549</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <div class="product-card">
          <img src="assets/Core i9-14900K.png" alt="Intel Core i9-14900K">
          <div class="product-info">
            <h3>Intel Core i9-14900K</h3>
            <ul>
              <li>24 Cores / 32 Threads</li>
              <li>6.0 GHz Boost</li>
              <li>LGA1700 Socket</li>
            </ul>
            <p class="price">$589</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <div class="product-card">
          <img src="assets/Ryzen 7 7800X3D.jpg" alt="Ryzen 7 7800X3D">
          <div class="product-info">
            <h3>AMD Ryzen 7 7800X3D</h3>
            <ul>
              <li>8 Cores / 16 Threads</li>
              <li>5.0 GHz Boost</li>
              <li>3D V-Cache</li>
            </ul>
            <p class="price">$449</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <div class="product-card">
          <img src="assets/Ryzen 7 7800X3D.jpg" alt="Ryzen 7 7800X3D">
          <div class="product-info">
            <h3>AMD Ryzen 7 7800X3D</h3>
            <ul>
              <li>8 Cores / 16 Threads</li>
              <li>5.0 GHz Boost</li>
              <li>3D V-Cache</li>
            </ul>
            <p class="price">$449</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <div class="product-card">
          <img src="assets/Ryzen 7 7800X3D.jpg" alt="Ryzen 7 7800X3D">
          <div class="product-info">
            <h3>AMD Ryzen 7 7800X3D</h3>
            <ul>
              <li>8 Cores / 16 Threads</li>
              <li>5.0 GHz Boost</li>
              <li>3D V-Cache</li>
            </ul>
            <p class="price">$449</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <div class="product-card">
          <img src="assets/Ryzen 7 7800X3D.jpg" alt="Ryzen 7 7800X3D">
          <div class="product-info">
            <h3>AMD Ryzen 7 7800X3D</h3>
            <ul>
              <li>8 Cores / 16 Threads</li>
              <li>5.0 GHz Boost</li>
              <li>3D V-Cache</li>
            </ul>
            <p class="price">$449</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <div class="product-card">
          <img src="assets/Ryzen 7 7800X3D.jpg" alt="Ryzen 7 7800X3D">
          <div class="product-info">
            <h3>AMD Ryzen 7 7800X3D</h3>
            <ul>
              <li>8 Cores / 16 Threads</li>
              <li>5.0 GHz Boost</li>
              <li>3D V-Cache</li>
            </ul>
            <p class="price">$449</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <div class="product-card">
          <img src="assets/Ryzen 7 7800X3D.jpg" alt="Ryzen 7 7800X3D">
          <div class="product-info">
            <h3>AMD Ryzen 7 7800X3D</h3>
            <ul>
              <li>8 Cores / 16 Threads</li>
              <li>5.0 GHz Boost</li>
              <li>3D V-Cache</li>
            </ul>
            <p class="price">$449</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <div class="product-card">
          <img src="assets/Ryzen 7 7800X3D.jpg" alt="Ryzen 7 7800X3D">
          <div class="product-info">
            <h3>AMD Ryzen 7 7800X3D</h3>
            <ul>
              <li>8 Cores / 16 Threads</li>
              <li>5.0 GHz Boost</li>
              <li>3D V-Cache</li>
            </ul>
            <p class="price">$449</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <div class="product-card">
          <img src="assets/Ryzen 7 7800X3D.jpg" alt="Ryzen 7 7800X3D">
          <div class="product-info">
            <h3>AMD Ryzen 7 7800X3D</h3>
            <ul>
              <li>8 Cores / 16 Threads</li>
              <li>5.0 GHz Boost</li>
              <li>3D V-Cache</li>
            </ul>
            <p class="price">$449</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
      </div>

      <!-- GPU PRODUCTS -->
      <div id="gpu-section" class="product-grid">
        <div class="product-card">
          <img src="assets/rtx4090.jpg" alt="NVIDIA RTX 4090">
          <div class="product-info">
            <h3>NVIDIA RTX 4090</h3>
            <ul>
              <li>24GB GDDR6X</li>
              <li>16384 CUDA Cores</li>
              <li>450W TDP</li>
            </ul>
            <p class="price">$1599</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <div class="product-card">
          <img src="assets/rx7900xtx.jpg" alt="AMD RX 7900 XTX">
          <div class="product-info">
            <h3>AMD RX 7900 XTX</h3>
            <ul>
              <li>24GB GDDR6</li>
              <li>RDNA 3 Architecture</li>
              <li>355W TDP</li>
            </ul>
            <p class="price">$999</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <div class="product-card">
          <img src="assets/rtx4070ti.jpg" alt="NVIDIA RTX 4070 Ti">
          <div class="product-info">
            <h3>NVIDIA RTX 4070 Ti</h3>
            <ul>
              <li>12GB GDDR6X</li>
              <li>DLSS 3.0</li>
              <li>285W TDP</li>
            </ul>
            <p class="price">$799</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
      </div>

      <!-- RAM PRODUCTS (hidden by default) -->
      <div id="memory-section" class="product-grid">
        <!-- RAM Product 1 -->
        <div class="product-card">
          <img src="assets/vengeance-rgb-32gb.jpg" alt="Corsair Vengeance RGB 32GB">
          <div class="product-info">
            <h3>Corsair Vengeance RGB 32GB</h3>
            <ul>
              <li>DDR5-6000</li>
              <li>32GB (2x16GB)</li>
              <li>RGB Lighting</li>
            </ul>
            <p class="price">$129</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- RAM Product 2 -->
        <div class="product-card">
          <img src="assets/trident-z5-64gb.jpg" alt="G.Skill Trident Z5 64GB">
          <div class="product-info">
            <h3>G.Skill Trident Z5 64GB</h3>
            <ul>
              <li>DDR5-6400</li>
              <li>64GB (2x32GB)</li>
              <li>Low Latency</li>
            </ul>
            <p class="price">$249</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- RAM Product 3 -->
        <div class="product-card">
          <img src="assets/fury-beast-32gb.jpg" alt="Kingston Fury Beast 32GB">
          <div class="product-info">
            <h3>Kingston Fury Beast 32GB</h3>
            <ul>
              <li>DDR5-5200</li>
              <li>32GB (2x16GB)</li>
              <li>Budget Friendly</li>
            </ul>
            <p class="price">$99</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
      </div>

      <!-- MOTHERBOARD PRODUCTS -->
      <div id="motherboard-section" class="product-grid">
        <!-- Motherboard 1 -->
        <div class="product-card">
          <img src="assets/rog-crosshair-x670e.jpg" alt="ASUS ROG Crosshair X670E">
          <div class="product-info">
            <h3>ASUS ROG Crosshair X670E</h3>
            <ul>
              <li>AM5 Socket</li>
              <li>PCIe 5.0</li>
              <li>WiFi 6E</li>
            </ul>
            <p class="price">$499</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- Motherboard 2 -->
        <div class="product-card">
          <img src="assets/z790-aorus-master.jpg" alt="Gigabyte Z790 AORUS Master">
          <div class="product-info">
            <h3>Gigabyte Z790 AORUS Master</h3>
            <ul>
              <li>LGA1700 Socket</li>
              <li>DDR5</li>
              <li>Thunderbolt 4</li>
            </ul>
            <p class="price">$449</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- Motherboard 3 -->
        <div class="product-card">
          <img src="assets/b650-gaming-plus.jpg" alt="MSI B650 Gaming Plus">
          <div class="product-info">
            <h3>MSI B650 Gaming Plus</h3>
            <ul>
              <li>AM5 Socket</li>
              <li>PCIe 4.0</li>
              <li>M.2 Heatsink</li>
            </ul>
            <p class="price">$199</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
      </div>

      <!-- STORAGE PRODUCTS -->
      <div id="storage-section" class="product-grid">
        <!-- Storage 1 -->
        <div class="product-card">
          <img src="assets/990-pro-2tb.jpg" alt="Samsung 990 PRO 2TB">
          <div class="product-info">
            <h3>Samsung 990 PRO 2TB</h3>
            <ul>
              <li>NVMe Gen 4</li>
              <li>7450 MB/s Read</li>
              <li>2TB Capacity</li>
            </ul>
            <p class="price">$199</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- Storage 2 -->
        <div class="product-card">
          <img src="assets/wd-black-sn850x.jpg" alt="Western Digital WD Black SN850X 1TB">
          <div class="product-info">
            <h3>Western Digital WD Black SN850X 1TB</h3>
            <ul>
              <li>NVMe Gen 4</li>
              <li>7300 MB/s Read</li>
              <li>1TB Capacity</li>
            </ul>
            <p class="price">$129</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- Storage 3 -->
        <div class="product-card">
          <img src="assets/crucial-p3-plus-4tb.jpg" alt="Crucial P3 Plus 4TB">
          <div class="product-info">
            <h3>Crucial P3 Plus 4TB</h3>
            <ul>
              <li>NVMe Gen 4</li>
              <li>5000 MB/s Read</li>
              <li>4TB Capacity</li>
            </ul>
            <p class="price">$299</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
      </div>

      <!-- PSU PRODUCTS -->
      <div id="psu-section" class="product-grid">
        <!-- PSU 1 -->
        <div class="product-card">
          <img src="assets/corsair-rm1000x.jpg" alt="Corsair RM1000x">
          <div class="product-info">
            <h3>Corsair RM1000x</h3>
            <ul>
              <li>1000W</li>
              <li>80+ Gold</li>
              <li>Fully Modular</li>
            </ul>
            <p class="price">$179</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- PSU 2 -->
        <div class="product-card">
          <img src="assets/evga-supernova-850-g6.jpg" alt="EVGA SuperNOVA 850 G6">
          <div class="product-info">
            <h3>EVGA SuperNOVA 850 G6</h3>
            <ul>
              <li>850W</li>
              <li>80+ Gold</li>
              <li>Fully Modular</li>
            </ul>
            <p class="price">$139</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- PSU 3 -->
        <div class="product-card">
          <img src="assets/seasonic-prime-tx-1600.jpg" alt="Seasonic PRIME TX-1600">
          <div class="product-info">
            <h3>Seasonic PRIME TX-1600</h3>
            <ul>
              <li>1600W</li>
              <li>80+ Titanium</li>
              <li>Fully Modular</li>
            </ul>
            <p class="price">$399</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
      </div>

      <!-- CASE PRODUCTS  -->
      <div id="case-section" class="product-grid">
        <!-- Case 1 -->
        <div class="product-card">
          <img src="assets/corsair-5000d-airflow.webp" alt="Corsair 5000D Airflow">
          <div class="product-info">
            <h3>Corsair 5000D Airflow</h3>
            <ul>
              <li>Mid Tower</li>
              <li>Tempered Glass</li>
              <li>USB-C Front Panel</li>
            </ul>
            <p class="price">$164</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- Case 2 -->
        <div class="product-card">
          <img src="assets/nzxt-h7-flow.jpg" alt="NZXT H7 Flow">
          <div class="product-info">
            <h3>NZXT H7 Flow</h3>
            <ul>
              <li>Mid Tower</li>
              <li>Mesh Front</li>
              <li>Cable Management</li>
            </ul>
            <p class="price">$129</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- Case 3 -->
        <div class="product-card">
          <img src="assets/lian-li-o11-dynamic.jpg" alt="Lian Li O11 Dynamic">
          <div class="product-info">
            <h3>Lian Li O11 Dynamic</h3>
            <ul>
              <li>Mid Tower</li>
              <li>Dual Chamber</li>
              <li>Showcase Design</li>
            </ul>
            <p class="price">$159</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
      </div>

      <!-- COOLING PRODUCTS -->
      <div id="cooling-section" class="product-grid">
        <!-- Cooling 1 -->
        <div class="product-card">
          <img src="assets/nzxt-kraken-x73.webp" alt="NZXT Kraken X73">
          <div class="product-info">
            <h3>NZXT Kraken X73</h3>
            <ul>
              <li>360mm AIO</li>
              <li>RGB Pump</li>
              <li>Quiet Operation</li>
            </ul>
            <p class="price">$179</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- Cooling 2 -->
        <div class="product-card">
          <img src="assets/noctua-nh-d15-chromax.jpg" alt="Noctua NH-D15 chromax.black">
          <div class="product-info">
            <h3>Noctua NH-D15 chromax.black</h3>
            <ul>
              <li>Dual Tower</li>
              <li>Premium Fans</li>
              <li>Silent</li>
            </ul>
            <p class="price">$109</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>

        <!-- Cooling 3 -->
        <div class="product-card">
          <img src="assets/corsair-icue-h150i-elite.webp" alt="Corsair iCUE H150i Elite">
          <div class="product-info">
            <h3>Corsair iCUE H150i Elite</h3>
            <ul>
              <li>360mm AIO</li>
              <li>LCD Display</li>
              <li>RGB Fans</li>
            </ul>
            <p class="price">$189</p>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
      </div>
    </section>
  </main>
  
  <footer class="site-footer">
    <div class="container">
      <p>© 2025 PCPick — All rights reserved.</p>
    </div>
  </footer>

  <!-- Cart summary (floating panel, reuses build summary styles) -->
  <aside class="build-summary-panel" id="cart-summary" aria-hidden="true">
    <div class="build-summary-inner">
      <header class="build-summary-header">
        <span class="build-summary-icon" aria-hidden="true">
          <img src="assets/cart.png" alt="">
        </span>
        <div>
          <p class="build-summary-label">Your Cart</p>
          <p class="build-summary-note">Items added to your cart</p>
        </div>
      </header>
      <ul class="build-summary-list" id="cart-list"></ul>
      <p class="build-summary-note" id="cart-empty">Your cart is empty. Add an item to see it here.</p>
      <div class="build-summary-totals" id="cart-totals" hidden>
        <div class="summary-total-row">
          <span>Subtotal</span>
          <strong id="cart-subtotal">$0.00</strong>
        </div>
        <div class="summary-total-row">
          <span>VAT (12%)</span>
          <strong id="cart-vat">$0.00</strong>
        </div>
        <div class="summary-total-row summary-grand-total">
          <span>Total</span>
          <strong id="cart-total">$0.00</strong>
        </div>
        <button class="btn checkout-btn" type="button">Checkout</button>
      </div>
    </div>
  </aside>

  <button
    type="button"
    class="build-toggle"
    id="cart-toggle"
    aria-label="Toggle cart summary"
    aria-controls="cart-summary"
    aria-expanded="false"
  >
    <span class="build-toggle-left">
      <span class="build-toggle-cart" aria-hidden="true"><img src="assets/cart.png" alt="" loading="lazy"></span>
      <span class="build-toggle-text">
        <span class="build-toggle-title">Cart</span>
        <span class="build-toggle-count" id="cart-count">(0)</span>
      </span>
    </span>
    <span class="build-toggle-chevron" aria-hidden="true"></span>
  </button>

  <div class="build-toast" id="product-toast" role="status" aria-live="polite" aria-hidden="true"></div>

  <script src="script.js"></script>
  <script>
    const productTabs = document.querySelectorAll(".products .product-tabs .tab");
    const productSections = document.querySelectorAll(".products .product-grid");

    if (productTabs.length && productSections.length) {
      const showProductSection = (targetId) => {
        productSections.forEach((section) => {
          section.style.display = section.id === targetId ? "grid" : "none";
        });
      };

      productTabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          productTabs.forEach((btn) => btn.classList.remove("active"));
          tab.classList.add("active");
          showProductSection(tab.dataset.cat);
        });
      });

      showProductSection(productTabs[0]?.dataset.cat ?? productSections[0]?.id);
    }
  </script>
  <script>
    (function(){
      const cartToggle = document.getElementById('cart-toggle');
      const cartSummary = document.getElementById('cart-summary');
      const cartList = document.getElementById('cart-list');
      const cartCount = document.getElementById('cart-count');
      const cartTotals = document.getElementById('cart-totals');
      const cartSubtotalEl = document.getElementById('cart-subtotal');
      const cartVatEl = document.getElementById('cart-vat');
      const cartTotalEl = document.getElementById('cart-total');
      const cartEmpty = document.getElementById('cart-empty');
      const toast = document.getElementById('product-toast');

      const fmt = new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',minimumFractionDigits:2});
      const parsePrice = (t)=>{const n=Number((t||'').replace(/[^0-9.]/g,''));return Number.isFinite(n)?n:0};

      // key -> { name, unit, qty } for items already in the cart
      const cartItems = new Map();
      // key -> qty selected via quantity controls (not yet added)
      const selectedQuantities = new Map();

      const VAT_RATE = 0.12;
      const renderTotals = () => {
        const qtyTotal = Array.from(cartItems.values()).reduce((s,i)=>s+i.qty,0);
        const subtotal = Array.from(cartItems.values()).reduce((s,i)=>s + (i.unit*i.qty),0);
        const vat = subtotal * VAT_RATE;
        const total = subtotal + vat;
        cartCount.textContent = `(${qtyTotal})`;
        if (cartEmpty) cartEmpty.hidden = qtyTotal > 0 ? true : false;
        if (cartTotals) {
          cartTotals.hidden = qtyTotal === 0;
          if (cartSubtotalEl) cartSubtotalEl.textContent = fmt.format(subtotal);
          if (cartVatEl) cartVatEl.textContent = fmt.format(vat);
          if (cartTotalEl) cartTotalEl.textContent = fmt.format(total);
        }
      };

      const productKey = (name, unit)=>`${name}|${unit}`;

      const updateCartRowQty = (key) => {
        const row = cartList?.querySelector(`li[data-key="${key}"]`);
        if (!row) return;
        const q = cartItems.get(key)?.qty ?? 0;
        const input = row.querySelector('.cart-qty-input');
        if (input) input.value = String(Math.max(1, q));
      };

      const ensureCartRow = (key, name, unit) => {
        let row = cartList?.querySelector(`li[data-key="${key}"]`);
        if (row) return row;
        row = document.createElement('li');
        row.classList.add('has-selection');
        row.dataset.key = key;
        row.innerHTML = `
          <span>Item</span>
          <div class="summary-selection">
            <strong class="has-selection">${name}</strong>
            <span class="summary-price">${fmt.format(unit)}</span>
          </div>
          <div class="cart-qty-controls">
            <button type="button" class="cart-qty-minus" aria-label="Decrease quantity">-</button>
            <input type="number" class="cart-qty-input" aria-label="Quantity" value="1" min="1" inputmode="numeric">
            <button type="button" class="cart-qty-plus" aria-label="Increase quantity">+</button>
          </div>
          <button class="summary-clear" type="button" aria-label="Remove from cart">x</button>`;
        cartList?.appendChild(row);
        row.querySelector('.summary-clear')?.addEventListener('click', ()=>{
          cartItems.delete(key);
          row.remove();
          renderTotals();
        });

        const qtyInput = row.querySelector('.cart-qty-input');

        row.querySelector('.cart-qty-plus')?.addEventListener('click', ()=>{
          adjustCartQuantity(name, unit, 1);
        });

        row.querySelector('.cart-qty-minus')?.addEventListener('click', ()=>{
          adjustCartQuantity(name, unit, -1);
        });

        qtyInput?.addEventListener('input', () => {
          const value = Math.max(1, Math.floor(Number(qtyInput.value) || 1));
          qtyInput.value = String(value);
          const key = productKey(name, unit);
          const current = cartItems.get(key);
          if (!current) return;
          const delta = value - current.qty;
          if (delta !== 0) {
            adjustCartQuantity(name, unit, delta);
          }
        });
        return row;
      };

      const adjustCartQuantity = (name, unit, delta) => {
        if (!delta) return;
        const key = productKey(name, unit);
        const current = cartItems.get(key) || { name, unit, qty: 0 };
        current.qty = Math.max(0, current.qty + delta);
        if (current.qty === 0) {
          cartItems.delete(key);
          cartList?.querySelector(`li[data-key="${key}"]`)?.remove();
        } else {
          cartItems.set(key, current);
          ensureCartRow(key, name, unit);
          updateCartRowQty(key);
        }
        renderTotals();
      };

      const showToast = (msg) => {
        if (!toast) return;
        toast.textContent = msg;
        toast.setAttribute('aria-hidden','false');
        toast.classList.add('is-visible');
        clearTimeout(showToast.tid);
        showToast.tid = setTimeout(()=>{
          toast.classList.remove('is-visible');
          toast.setAttribute('aria-hidden','true');
        }, 2000);
      };

      const collapseCart = () => {
        cartToggle?.setAttribute('aria-expanded','false');
        cartSummary?.classList.remove('is-visible');
        cartSummary?.setAttribute('aria-hidden','true');
      };

      cartToggle?.addEventListener('click', ()=>{
        const expanded = cartToggle.getAttribute('aria-expanded') === 'true';
        const next = !expanded;
        cartToggle.setAttribute('aria-expanded', String(next));
        cartSummary.classList.toggle('is-visible', next);
        cartSummary.setAttribute('aria-hidden', expanded ? 'true' : 'false');
      });

      document.addEventListener('click', (event) => {
        if (!cartSummary || !cartToggle) return;
        if (event.target.closest('#cart-summary') || event.target.closest('#cart-toggle')) return;
        if (event.target.closest('.site-header')) return;
        if (event.target.closest('button, a, input, textarea, select, [role="button"], [contenteditable=""], [contenteditable="true"]')) return;
        if (cartToggle.getAttribute('aria-expanded') === 'true') {
          collapseCart();
        }
      });

      // Inject quantity controls and wire events
      document.querySelectorAll('.add-cart-btn').forEach(btn=>{
        const card = btn.closest('.product-card');
        if (!card) return;
        // create quantity controls next to the button
        const row = document.createElement('div');
        row.className = 'add-cart-row';
        const qc = document.createElement('div');
        qc.className = 'qty-controls';
        qc.innerHTML = `<button type="button" class="qty-minus" aria-label="Decrease quantity">-</button>
                        <input type="number" class="qty-amount" value="0" min="0" inputmode="numeric" aria-label="Quantity">
                        <button type="button" class="qty-plus" aria-label="Increase quantity">+</button>`;
        // Place quantity controls first, then the button
        row.appendChild(qc);
        row.appendChild(btn);

        const info = card.querySelector('.product-info');
        const price = card.querySelector('.price');
        const purchaseRow = document.createElement('div');
        purchaseRow.className = 'purchase-row';
        if (price) purchaseRow.appendChild(price);
        purchaseRow.appendChild(row);
        info?.appendChild(purchaseRow);

        const getData = () => {
          const name = card.querySelector('.product-info h3')?.textContent?.trim() || 'Item';
          const unit = parsePrice(card.querySelector('.price')?.textContent?.trim() || '$0');
          return { name, unit };
        };

        const amountInput = qc.querySelector('.qty-amount');

        const updateSelection = (key, next) => {
          const value = Math.max(0, next);
          selectedQuantities.set(key, value);
          if (amountInput) amountInput.value = String(value);
        };

        btn.addEventListener('click', ()=>{
          const {name, unit} = getData();
          const key = productKey(name, unit);
          const qty = selectedQuantities.get(key) ?? 0;
          if (qty <= 0) {
            showToast('Set a quantity first.');
            return;
          }
          adjustCartQuantity(name, unit, qty);
          showToast(`${qty} × ${name} added to cart!`);
          updateSelection(key, 0);
        });

        qc.querySelector('.qty-plus')?.addEventListener('click', ()=>{
          const {name, unit} = getData();
          const key = productKey(name, unit);
          const current = selectedQuantities.get(key) ?? 0;
          updateSelection(key, current + 1);
        });
        qc.querySelector('.qty-minus')?.addEventListener('click', ()=>{
          const {name, unit} = getData();
          const key = productKey(name, unit);
          const current = selectedQuantities.get(key) ?? 0;
          updateSelection(key, current - 1);
        });

        amountInput?.addEventListener('input', ()=>{
          const {name, unit} = getData();
          const key = productKey(name, unit);
          const parsed = Math.max(0, Math.floor(Number(amountInput.value) || 0));
          amountInput.value = String(parsed);
          updateSelection(key, parsed);
        });
      });
    })();
  </script>
</body>
</html>
